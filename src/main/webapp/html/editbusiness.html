<!DOCTYPE html>
<!--suppress ALL-->
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>编辑商机</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/layui/css/layui.css">

</head>
<style>
    .box{
        Margin:20px;
    }
    .box1{
        position: absolute;
        left: 20%;
        border: 1px black solid;
        width: 950px;
        height: 1500px;
    }
    .box2{
        background-color: #f8ffb3;
        width: 100%;
        height: 35px;
    }
    .box3{
        position: relative;
        top: 4px;
        left: 20px;
        font-size: 18px;
    }
    .box4{
        position: relative;
        top: 20px;
    }
    .box5{
        background-color: #f8ffb3;
        width: 100%;
        height: 35px;
        position:absolute;
        top: 280px;
    }
    .box8{
        position: relative;
        top: 4px;
        left: 20px;
        font-size: 18px;
    }
    .box10{
        width: 100px;
        position: absolute;
        left: -10px;
    }
    .box11{
        width:300px;
        height: 35px;
    }
    .box12{
        width: 100px;
        position: absolute;
        top:-20px;
        left: -10px;
    }
    .box13{
        position: absolute;
        top: -17px;
        left: 110px;
        width:300px;
        height: 35px;
    }
    .box14{
        position: relative;
        top: 30px;
    }
    .box15{
        background-color: #f8ffb3;
        position:absolute;
        top: 930px;
    }
    .box16{
        position:absolute;
        top: 280px;
        left: 133px;
        border: 1px black solid;
        width: 760px;
        height: 310px;
    }
    .box17{
        height: 40px;
        font-size: 18px;
        background-color: #666666 ;
    }
    .box18{
        position:absolute;
        top: 440px;
        left: 895px;
        border: 1px black solid;
        width: 490px;
        height: 150px;
    }
    .box19{
        position:absolute;
        top: 281px;
        left: 895px;
        border: 1px black solid;
        width: 490px;
        height: 160px;
    }
    .box20{
        position:absolute;
        top: 1350px;
        left: 150px;
    }
    .box21{
        position:absolute;
        top: 10px;
        left: 590px;
    }
    body{ text-align:right}
    .div{ margin:0 auto; width:800px; height:50px; border:1px  }
    /* css注释：为了观察效果设置宽度 边框 高度等样式 */
</style>
<script type="text/javascript">
    var shh=function(){
        window.location.href="/html/editbusiness.html";
    }
    var abc=function(){
        window.close()  ;
    }
</script>
<body>
<div style="width:100%;text-align:center">
    <form class="layui-form">
        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
            <legend><strong>编辑商机</strong><br /></legend>
        </fieldset>
        <div class="layui-inline" style="width: 100px;float: right">
            <button type="button" class="layui-btn" onclick="abc()">
                <i class="layui-icon">&#xe666;</i> 返回
            </button>
        </div>
        <div class="layui-inline" style="width: 100px;float: right">
            <button type="button" class="layui-btn" onclick="shh()">
                <i class="layui-icon">&#xe666;</i> 刷新
            </button>
        </div>

        <div class="layui-form-item" >
            <div class="layui-inline">
                <label class="layui-form-label"><font color="red">*</font>商机全称</label>
                <div class="layui-input-block">
                    <input type="text" name="allname" th:value="${business.allname}" id="allname" lay-verify="required" lay-reqtext="请输入商机全称" placeholder="请输入商机全称" autocomplete="off" style="width:400px; height:38px;" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item layui-inline">
                <label class="layui-form-label">优先级:</label>
                <div class="layui-input-block">
                    <input type="checkbox" lay-skin="primary" name="buspriority" value="1" title="低">
                    <input type="checkbox" lay-skin="primary" name="buspriority" value="2" title="中">
                    <input type="checkbox" lay-skin="primary" name="buspriority" value="3" title="高">
                </div>
            </div>
        </div>
        <div style="background:#e2d982; color:#FFF;width:1250px; height:38px;" class="div"><h2>客户信息</h2></div>
        <div style="background:rgba(23,34,226,0); color:rgba(255,255,255,0);width:1200px; height:38px;" class="div"></div>
        <div class="layui-form-item" >
            <div class="layui-inline">
                <label class="layui-form-label"><font color="red">*</font>客户名称</label>
                <div class="layui-input-block">
                    <input type="text" name="cliname" id="cliname" th:value="${client.cliname}" lay-verify="required"  placeholder="请输入客户名称" autocomplete="off" style="width:400px; height:38px;" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">所属行业</label>
                <div class="layui-input-block" style="width:400px; height:38px;">
                    <select name="industry" id="industry" lay-filter="aihao" >
                        <option value="0" th:selected="${client.industry=='0'} ? true:false">请选择</option>
                        <option value="1" th:selected="${client.industry=='1'} ? true:false">IT|互联网|通信|电子</option>
                        <option value="2" th:selected="${client.industry=='2'} ? true:false">金融|银行|保险</option>
                        <option value="3" th:selected="${client.industry=='3'} ? true:false">房产|建筑建设|物业</option>
                        <option value="4" th:selected="${client.industry=='4'} ? true:false">广告|传媒|印刷出版</option>
                        <option value="5" th:selected="${client.industry=='5'} ? true:false">消费零售|贸易|交通物流</option>
                        <option value="6" th:selected="${client.industry=='6'} ? true:false">加工制造|仪表设备</option>
                        <option value="7" th:selected="${client.industry=='7'} ? true:false">管理咨询|教育科研|中介服务</option>
                        <option value="8" th:selected="${client.industry=='8'} ? true:false">医药生物|医疗保健</option>
                        <option value="9" th:selected="${client.industry=='9'} ? true:false">酒店旅游</option>
                        <option value="10" th:selected="${client.industry=='10'} ? true:false">能源矿产|石油化工</option>
                        <option value="11" th:selected="${client.industry=='11'} ? true:false">政府|非赢利机构|科研</option>
                        <option value="12" th:selected="${client.industry=='12'} ? true:false">其他</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="layui-form-item" >
            <div class="layui-inline">
                <label class="layui-form-label">所在城市</label>
                <div class="layui-input-block">
                    <input type="text" name="city" id="city" th:value="${client.city}" lay-verify="required" lay-reqtext="请输入所在城市" placeholder="请输入所在城市" autocomplete="off" style="width:400px; height:38px;" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">详细地址</label>
                <div class="layui-input-block">
                    <input type="text" name="address" id="address" th:value="${client.address}" lay-verify="required" lay-reqtext="请输入您当前详细地址" placeholder="请输入详细地址" autocomplete="off" style="width:400px; height:38px;" class="layui-input">
                </div>
            </div>
        </div>
        <div style="background:#e2d982; color:#FFF;width:1250px; height:38px;" class="div"><h2>商机信息</h2></div>
        <div style="background:rgba(23,34,226,0); color:rgba(255,255,255,0);width:1200px; height:38px;" class="div"></div>

        <div class="layui-form-item" >
            <div class="layui-inline">
                <label class="layui-form-label"><font color="red">*</font>商机名称</label>
                <div class="layui-input-block">
                    <input type="text" name="busname" id="busname" th:value="${business.busname}" lay-verify="required" lay-reqtext="请输入商机名称" placeholder="请输入商机名称" autocomplete="off" style="width:400px; height:38px;" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">客户来源</label>
                <div class="layui-input-block" style="width:400px; height:38px;">
                    <select name="clisources" id="id" lay-filter="aihao" >
                        <option value="0" th:selected="${business.clisources=='0'} ? true:false">请选择</option>
                        <option value="1" th:selected="${business.clisources=='1'} ? true:false">老客户</option>
                        <option value="2" th:selected="${business.clisources=='2'} ? true:false">代理商</option>
                        <option value="3" th:selected="${business.clisources=='3'} ? true:false">互联网</option>
                        <option value="4" th:selected="${business.clisources=='4'} ? true:false">独立开发</option>
                        <option value="5" th:selected="${business.clisources=='5'} ? true:false">客户介绍</option>
                        <option value="6" th:selected="${business.clisources=='6'} ? true:false">合作伙伴</option>
                        <option value="7" th:selected="${business.clisources=='7'} ? true:false">促销活动</option>
                        <option value="8" th:selected="${business.clisources=='8'} ? true:false">媒体宣传</option>
                        <option value="9" th:selected="${business.clisources=='9'} ? true:false">电话访问</option>
                        <option value="10" th:selected="${business.clisources=='10'} ? true:false">客户来电</option>
                        <option value="11" th:selected="${business.clisources=='11'} ? true:false">二次销售</option>
                        <option value="12" th:selected="${business.clisources=='12'} ? true:false">公开招标</option>
                        <option value="13" th:selected="${business.clisources=='13'} ? true:false">研究会和展会</option>
                        <option value="14" th:selected="${business.clisources=='14'} ? true:false">其他</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="layui-form-item" >
            <div class="layui-inline">
                <label class="layui-form-label">预计成交金额</label>
                <div class="layui-input-block">
                    <input type="text" name="makemoney" th:value="${business.makemoney}" lay-verify="required" lay-reqtext="请输入预计成交金额" placeholder="请输入预计成交金额" autocomplete="off" style="width:400px; height:38px;" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">预计接单日期</label>
                <div class="layui-input-block">
                    <input type="text" name="statementdate" id="test1" th:value="${business.statementdate}" lay-verify="date" placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input box11"  style="width:400px; height:38px;">
                </div>
            </div>
        </div>

        <div class="layui-form-item" >
            <div class="layui-inline">
                <label class="layui-form-label">联系人</label>
                <div class="layui-input-block">
                    <input type="text" name="linkname" th:value="${business.linkname}" lay-verify="required" lay-reqtext="请输入联系人" placeholder="请输入联系人" autocomplete="off" style="width:400px; height:38px;" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">部门</label>
                <div class="layui-input-block">
                    <input type="text" name="linkdept" th:value="${business.linkdept}" lay-verify="required" lay-reqtext="请输入部门" placeholder="请输入部门" autocomplete="off" style="width:400px; height:38px;" class="layui-input">
                </div>
            </div>
        </div>

        <div class="layui-form-item" >
            <div class="layui-inline">
                <label class="layui-form-label">职务</label>
                <div class="layui-input-block">
                    <input type="text" name="linkduty" th:value="${business.linkduty}" lay-verify="required" lay-reqtext="请输入职务" placeholder="请输入职务" autocomplete="off" style="width:400px; height:38px;" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">固定电话</label>
                <div class="layui-input-block">
                    <input type="text" name="linkphone" th:value="${business.linkphone}" lay-verify="required" lay-reqtext="请输入固定电话" placeholder="请输入固定电话" autocomplete="off" style="width:400px; height:38px;" class="layui-input">
                </div>
            </div>
        </div>

        <div class="layui-form-item" >
            <div class="layui-inline">
                <label class="layui-form-label">移动电话</label>
                <div class="layui-input-block">
                    <input type="text" name="phone" th:value="${business.phone}" lay-verify="required" lay-reqtext="请输入移动电话" placeholder="请输入移动电话" autocomplete="off" style="width:400px; height:38px;" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">邮箱/QQ</label>
                <div class="layui-input-block">
                    <input type="text" name="email" th:value="${business.email}" lay-verify="required" lay-reqtext="请输入邮箱/QQ" placeholder="请输入邮箱/QQ" autocomplete="off" style="width:400px; height:38px;" class="layui-input">
                </div>
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <div class="layui-inline">
                <label class="layui-form-label" >主要业务需求</label>
                <div class="layui-input-block" >
                    <textarea name="busdemand" th:value="${business.busdemand}" placeholder="请输入主要业务需求" class="layui-textarea"  style="width:926px; height:190px;">
                        [[${business.busdemand}]]
                    </textarea>
                </div>
            </div>
        </div>
        <div class="layui-form-item" >
            <div class="layui-inline">
                <label class="layui-form-label">附件</label>
                <div class="layui-input-block">
                    <input type="file" name="busaccessory" th:value="${business.busaccessory}" lay-verify="required" lay-reqtext="请输入附件" placeholder="请输入附件" autocomplete="off" style="width:400px; height:38px;" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <div class="layui-input-block">
                    <div style="background:rgba(23,34,226,0); color:rgba(255,255,255,0);width:400px; height:38px;" class="div"></div>
                </div>
            </div>
        </div>

        <div class="layui-form-item" >
            <div class="layui-inline">
                <label class="layui-form-label">商机所属部门</label>
                <div class="layui-input-block">
                    <input type="text" name="busdept" th:value="${business.busdept}" lay-verify="required" lay-reqtext="请输入商机所属部门" placeholder="请输入商机所属部门" autocomplete="off" style="width:400px; height:38px;" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">商机负责人</label>
                <div class="layui-input-block">
                    <input type="text" name="busprincipal" th:value="${business.busprincipal}" lay-verify="required" lay-reqtext="请输入商机负责人" placeholder="请输入商机负责人" autocomplete="off" style="width:400px; height:38px;" class="layui-input">
                </div>
            </div>
        </div>
        <div class="layui-form-item" >
            <div class="layui-inline">
                <label class="layui-form-label">商机参与人</label>
                <div class="layui-input-block">
                    <input type="text" name="busparticipant" th:value="${business.busparticipant}" lay-verify="required" lay-reqtext="请输入商机参与人" placeholder="请输入商机参与人" autocomplete="off" style="width:400px; height:38px;" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">商机关注人</label>
                <div class="layui-input-block">
                    <input type="text" name="busfollower" th:value="${business.busfollower}" lay-verify="required" lay-reqtext="请输入商机关注人" placeholder="请输入商机关注人" autocomplete="off" style="width:400px; height:38px;" class="layui-input">
                </div>
            </div>
        </div>
        <div style="background:#e2d982; color:#FFF;width:1250px; height:38px;" class="div"><h2>处理流程日志</h2></div>
        <div style="background:rgba(23,34,226,0); color:rgba(255,255,255,0);width:1200px; height:38px;" class="div"></div>



        <div class="box15"><!--处理流程信息-->

            <div class="box16">
                <P class="box17">【处理过程】</P>
                <span class="box21"><a><font color="red">>>查看流程图</font></a></span>
                <div>
                    玩家一号
                </div>
            </div>
            <div class="box18">
                <P class="box17">【父事务】</P>
                <div>
                    玩家二号
                </div>
            </div>
            <div class="box19">
                <P class="box17">【子事务】</P>
                <div>
                    玩家三号
                </div>
            </div>
        </div>
        <div style="background:rgba(23,34,226,0); color:rgba(255,255,255,0);width:1200px; height:38px;" class="div"></div>
        <div style="background:rgba(23,34,226,0); color:rgba(255,255,255,0);width:1200px; height:38px;" class="div"></div>
        <div style="background:rgba(23,34,226,0); color:rgba(255,255,255,0);width:1200px; height:38px;" class="div"></div>
        <div style="background:rgba(23,34,226,0); color:rgba(255,255,255,0);width:1200px; height:38px;" class="div"></div>
        <div style="background:rgba(23,34,226,0); color:rgba(255,255,255,0);width:1200px; height:38px;" class="div"></div>
        <div style="background:rgba(23,34,226,0); color:rgba(255,255,255,0);width:1200px; height:38px;" class="div"></div>
        <div style="background:rgba(23,34,226,0); color:rgba(255,255,255,0);width:1200px; height:38px;" class="div"></div>
        <div style="background:rgba(23,34,226,0); color:rgba(255,255,255,0);width:1200px; height:38px;" class="div"></div>
        <div style="background:rgba(23,34,226,0); color:rgba(255,255,255,0);width:1200px; height:38px;" class="div"></div>
        <div class="layui-form-item" >
            <div class="layui-inline">
                <label class="layui-form-label">状态</label>
                <div class="layui-input-block" style="width:400px; height:38px;">
                    <select name="busstage" id="id" lay-filter="aihao" >
                        <option value="0" th:selected="${business.busstage=='0'} ? true:false">请选择</option>
                        <option value="初级沟通" th:selected="${business.busstage=='初级沟通'} ? true:false">初级沟通</option>
                        <option value="方案和报价" th:selected="${business.busstage=='方案和报价'} ? true:false">方案和报价</option>
                        <option value="竞争和投标" th:selected="${business.busstage=='竞争和投标'} ? true:false">竞争和投标</option>
                        <option value="商务谈判" th:selected="${business.busstage=='商务谈判'} ? true:false">商务谈判</option>
                        <option value="成交" th:selected="${business.busstage=='成交'} ? true:false">成交</option>
                        <option value="丢单" th:selected="${business.busstage=='丢单'} ? true:false">丢单</option>
                        <option value="搁置" th:selected="${business.busstage=='搁置'} ? true:false">搁置</option>
                    </select>
                </div>
            </div>
            <div class="layui-inline">
                <div class="layui-input-block">
                    <div style="background:rgba(23,34,226,0); color:rgba(255,255,255,0);width:400px; height:38px;" class="div"></div>
                </div>
            </div>
        </div>
        <div align="center" style="position:relative;top:10px">
            <button type="button" class="layui-btn layui-btn-radius" lay-submit="" lay-filter="demo1" >编辑</button>
            <button type="button" class="layui-btn layui-btn-primary layui-btn-radius" onclick="abc()">取消</button>
        </div>
    </form>

</div>

<!-- 你的HTML代码 -->
<script src="/layui/layui.js"></script>
<script>
    //一般直接写在一个js文件中
    layui.use(['layer', 'form','table','jquery','laydate','upload'], function(){
        var layer = layui.layer
            ,form = layui.form
            ,table = layui.table
            ,$=layui.jquery
            ,laydate = layui.laydate
            ,upload = layui.upload;

        form.on('submit(demo1)', function(data){
            $.get({
                url:"/business/queryadd.do",
                data:data.field,
                success:function (data) {
                    if(data.code="0"){
                        var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
                        parent.layer.close(index);
                    }
                }
            })
            return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
        });
        //时间
        laydate.render({
            elem: '#test1' //指定元素
        });
        laydate.render({
            elem: '#test2' //指定元素
        });

        //保存
        form.on('submit(formTest)', function(data){
            alert("数据提交");
            $.get({
                url:"/aftersale/insert.do",
                data:data.field,
                success:function (data) {
                    alert(data.msg());
                }
            })
            return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
        });

        //预加载函数
        $(function () {
            //拿到客户名称跟商机名称，拼接到商机全称里面
            $("#busname").blur(function () {
                var busname=($("#busname").val());
                var cliname=$("#cliname").val();
                $("#allname").val(cliname+"-"+busname);
            })
            //当焦点移开客户名称时
            //1.拿到文本框的值去数据库查询
            //2.把查询对象返回  如果有值就把数据渲染页面
            //3.如果没有值，就弹窗提示需要添加用户（一个取消，和确认）  点击取消可在当前页面继续输入客户名称，点击确认跳转到添加客户页面
            $("#cliname").blur(function () {

                var cliname=$("#cliname").val();
                $.get({
                    url:"/client/verify.do",
                    data:"cliname="+cliname,
                    success:function (data) {
                        if(data.code=="0"){
                            var list=data.data;
                            if(list.length==0){
                                //说明没有数据弹窗提示
                                layer.confirm('该客户信息不存在，是否去添加！', {
                                    btn : [ '确定', '取消' ]//按钮
                                }, function(index) {
                                    layer.close(index);
                                    //此处请求后台程序，下方是成功后的前台处理……
                                    var index = layer.load(0,{shade: [0.7, '#393D49']}, {shadeClose: true}); //0代表加载的风格，支持0-2
                                    location.href="/html/clientadd.html";
                                });
                            }else{
                                if(list.left>1){
                                    //名字有重复的
                                    alert("名字有重复的");
                                }else{
                                    //有值得情况
                                    $("#cliname").val(list[0].cliname);
                                    var  industry=list[0].industry;
                                    $("#industry option").each(function () {
                                        if($(this).val()==list[0].industry){
                                            form.render();
                                            $(this).attr("selected","selected");
                                            form.render('select');// 再次渲染sele
                                        }
                                    })
                                    $("#city").val(list[0].city);
                                    $("#address").val(list[0].address);

                                    $("#allname").val($("#cliname").val());

                                }
                            }
                        }
                    }
                })

            })

        })




    });
</script>
</body>
</html>