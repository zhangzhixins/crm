<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8">
    <title>新增跟单</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/layui/css/layui.css"  media="all">
    <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
</head>
<style>
    .box1{
        position: absolute;
        left: 10%;
        border: 1px rgba(0, 0, 0, 0.99) solid;
        width: 80%;
        height: 200%;
    }
    .box2{
        background-color: rgba(235, 255, 179, 0.6);
        width: 100%;
        height: 35px;
    }
    .box3{
        position: relative;
        top: 4px;
        left: 20px;
        font-size: 18px;
    }
    .box4{
        position: relative;
        top: 4px;
        left: 10px;
    }
</style>
<body>
<div class="box1">
<form class="layui-form" action="">
    <div class="layui-form-item layui-box" ><!--页面头部信息-->
        <div class="layui-inline" style="width: 500px;float: left">
            <input type="text" style="border:none;font-size:30px" size="100"   id="theme" name="theme" readonly="readonly">
        </div>
        <div class="layui-inline" style="width: 100px;float: right">
            <button type="button" class="layui-btn layui-btn-primary">
                <i class="layui-icon">&#xe608;返回</i>
            </button>
        </div>
        <div class="layui-inline" style="width: 100px;float: right">
            <button type="button" class="layui-btn layui-btn-primary" id="brefresh">
                <i class="layui-icon">&#xe666;刷新</i>
            </button>
        </div>
    </div>
    <hr>
    <div class="layui-form-item">
        <div class="layui-input-block">
            <div class="layui-inline">
                <h4>跟单主题</h4>
            </div>
            <div class="layui-inline">
                <select id="business" name="busid"  lay-filter="busid">
                    <option value="0">请选择</option>
                </select>
            </div>
        </div>
    </div>
    <div class="box2"><!--基本信息-->
        <div class="layui-inline layui-form-item">
            <div class="layui-input-block">
                <p class="box3">历史跟单记录</p>
            </div>
        </div>
        <div class="layui-inline layui-form-item">
            <div class="layui-input-block">
                <p class="box4">*如果要修改 我的跟单记录，请在 我的工作日程 中进行</p>
            </div>
        </div>
    </div>
    <div id="lishi">
    </div>
    <div class="box2 layui-form-item"><!--基本信息-->
        <div class="layui-inline">
            <div class="layui-input-block">
                <p class="box3">新增跟单记录</p>
            </div>
        </div>
        <div class="layui-inline">
            <div class="layui-input-block">
                <p class="box4">*可以预约几天后跟单，并在 我的工作日程 中获得提醒</p>
            </div>
        </div>
    </div>

    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">跟单时间</label>
            <div class="layui-input-block">
                <input type="text" name="doctime" id="date1" lay-verify="date" placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">跟单分类</label>
                <div class="layui-input-block">
                    <select name="docify" lay-filter="aihao">
                        <option value="0">请选择</option>
                        <option value="电话沟通">电话沟通</option>
                        <option value="邮件联系">邮件联系</option>
                        <option value="网上交流">网上交流</option>
                        <option value="上面拜访">上面拜访</option>
                        <option value="产品送样">产品送样</option>
                        <option value="客户招待">客户招待</option>
                        <option value="其他">其他</option>
                    </select>
                </div>
        </div>
                <div class="layui-inline">
                    <label class="layui-form-label">跟单人：</label>
                        <div class="layui-input-block" >
                             <input type="text" name="docpeople" required  lay-verify="required" readonly="readonly"  autocomplete="off" class="layui-input" value="王娜" style="border: none ">
                        </div>
                </div>
    </div>
    <div class="layui-form-item layui-form-text">
        <label class="layui-form-label">详细内容</label>
        <div class="layui-input-block">
            <textarea placeholder="请输入内容" class="layui-textarea" name="doccontent"></textarea>
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-input-block">
            <button type="submit" class="layui-btn" lay-submit lay-filter="demo1">立即提交</button>
            <button type="reset" class="layui-btn layui-btn-primary">返回</button>
        </div>
    </div>
</form>
</div>
<script src="/layui/layui.js" charset="utf-8"></script>
<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
<script>
    layui.use(['form', 'laydate','layer'], function(){
        var form = layui.form
            ,layer = layui.layer
            ,laydate = layui.laydate
            ,$=layui.jquery;

        //日期
        laydate.render({
            elem: '#date1'
        });

        //监听提交
        form.on('submit(demo1)', function(data){
            layer.msg(JSON.stringify(data.field));
            $.ajax({
                url:"/documentary/adddoc.do",
                data:data.field,
               success:function () {
                    layer.msg("提交成功");
                }
            })
            return false;
        });

        form.on('select(busid)',function (data) {
            if (data.value!=0){
                $("#theme").val(data.elem[data.elem.selectedIndex].text);
                var busid=data.value;
                $.ajax({
                    type:'post',
                    url:'/documentary/idselectdoc.do?busid='+busid,
                    dataType:"json",
                    success:function (data){
                        var str="";
                        /*if (!data.code().eq("0")){*/
                            layer.msg(data.data.length);
                            for (var i = 0;i<data.data.length;i++) {
                                str+=" <div class=\"layui-form-item\">\n" +
                                    "            <div class=\"layui-form-item layui-inline\">\n" +
                                    "                <label class=\"layui-form-label\">*跟单时间:</label>\n" +
                                    "                <div class=\"layui-input-block\">\n" +
                                    "                    <input type=\"text\"  value=\"+'"+data.data[i].doctime+"'+\" autocomplete=\"off\" class=\"layui-input\">\n" +
                                    "                </div>\n" +
                                    "            </div>\n" +
                                    "            <div class=\"layui-form-item layui-inline\">\n" +
                                    "                <label class=\"layui-form-label\">*跟单分类:</label>\n" +
                                    "                <div class=\"layui-input-block\">\n" +
                                    "                    <input type=\"text\"  value=\"'"+data.data[i].docify+"'\" autocomplete=\"off\" class=\"layui-input\">\n" +
                                    "                </div>\n" +
                                    "            </div>\n" +
                                    "            <div class=\"layui-form-item layui-inline\">\n" +
                                    "                <label class=\"layui-form-label\">跟单人:</label>\n" +
                                    "                <div class=\"layui-input-block\">\n" +
                                    "                    <input type=\"text\"  value=\"'"+data.data[i].docpeople+"'\" autocomplete=\"off\" class=\"layui-input\">\n" +
                                    "                </div>\n" +
                                    "            </div>\n" +
                                    "        </div>\n" +
                                    "        <div class=\"layui-form-item\">\n" +
                                    "            <div class=\"layui-form-item layui-inline\">\n" +
                                    "                <label class=\"layui-form-label\">详细内容:</label>\n" +
                                    "                <div class=\"layui-input-block\">\n" +
                                    "                    <input type=\"text\"  style=\"width:500px\" value=\"'"+data.data[i].doccontent+"'\" autocomplete=\"off\" class=\"layui-input\">\n" +
                                    "                </div>\n" +
                                    "            </div>\n" +
                                    "        </div>\n" +
                                    "        <div class=\"layui-form-item\">\n" +
                                    "            <div class=\"layui-form-item layui-inline\">\n" +
                                    "                <label class=\"layui-form-label\">附件:</label>\n" +
                                    "                <div class=\"layui-input-block\">\n" +
                                    "                    <input type=\"text\"  value=\"'"+data.data[i].docaccessory+"'\" autocomplete=\"off\" class=\"layui-input\">\n" +
                                    "                </div>\n" +
                                    "            </div>\n" +
                                    "        </div> ";
                            }
                            $("#lishi").html(str);
                        /*}else{
                            str+="sssssssssssssss"
                        }*/
                    }
                });

            }
        })


        //预加载函数
        $(function () {
            $.ajax({
                url:"/documentary/selectbusiness.do",
                type:'post',
                success:function (data) {
                    for (var i=0;i<data.data.length;i++){
                        $("#business").append(new Option(data.data[i].busname,data.data[i].busid,));
                    }
                    form.render();
                }
            })
        })

    });
</script>

</body>
</html>